var O=Object.defineProperty;var Q=(a,t,e)=>t in a?O(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var c=(a,t,e)=>(Q(a,typeof t!="symbol"?t+"":t,e),e);import{E as B,S as W,ao as H,al as A,G as T,X as L,B as U,b as z,ak as q,C as X,c as Y,q as E,V as p,aA as _}from"./example-e9f3c815.js";import{G as $}from"./index-ba66c6be.js";import{O as J}from"./OrbitControls-94bee5b1.js";const K=function(){const a=new p,t=new p,e=new p;return function(s){const i=s.normal,r=new E;return Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y),a.crossVectors(t.normalize(),i),s.coplanarPoint(e),r.set(a.x,t.x,i.x,e.x,a.y,t.y,i.y,e.y,a.z,t.z,i.z,e.z,0,0,0,1)}}(),N=[new p(1,0,+Math.SQRT1_2),new p(-1,0,+Math.SQRT1_2),new p(0,1,-Math.SQRT1_2),new p(0,-1,-Math.SQRT1_2)],Z=[0,1,2,0,2,3,0,3,1,1,3,2],x=at(N,Z),tt=x.map(K),F=nt(5,2.5),C=Object.freeze([]);function R(a,t,e){for(let n=0,s=t.length;n<s;n++)a[n].copy(t[n]).applyMatrix4(e)}function et(a,t,e){const n=t.parent;a.updateMatrixWorld(),t.matrix.copy(n.matrixWorld).invert(),t.applyMatrix4(e)}function at(a,t){const e=t.length/3,n=new Array(e);for(let s=0,i=0;s<e;s++,i+=3){const r=a[t[i]],d=a[t[i+1]],h=a[t[i+2]];n[s]=new _().setFromCoplanarPoints(r,d,h)}return n}function V(a){const t=new Array(a);for(let e=0;e<a;e++)t[e]=new _;return t}function nt(a,t){const e=V(a);for(let n=0;n<a;n++){const s=e[n],i=n*Math.PI*2/a;s.normal.set(Math.cos(i),0,Math.sign(i)),s.constant=t}return e}class ct extends B{constructor(){super(...arguments);c(this,"clipMaterial");c(this,"object");c(this,"transform",new E);c(this,"tmpMatrix",new E);c(this,"volumeVisualization");c(this,"globalClippingPlanes")}init(e){super.init(e);const n=this.utils.createPerspectiveCamera({fov:36,near:.25,far:16},[0,1.5,3]);this.camera=n;const s=new W;this.scene=s,s.add(new H(16777215,.3));const i=this.utils.createSpotLight({intensity:.5,angle:Math.PI/5,penumbra:.2},[2,3,3],{near:3,far:10,size:1024});s.add(i);const r=this.utils.createDirectionalLight(16777215,[0,2,0],[1,-1,-1,1,1,10]);r.intensity=.5,r.shadow.mapSize.set(1024,1024),s.add(r);const d=V(x.length),h=new A({color:15600144,shininess:100,side:T,clippingPlanes:d,clipShadows:!0});this.clipMaterial=h;const y=new L,k=new U(.18,.18,.18);for(let o=-2;o<=2;o++)for(let m=-2;m<=2;m++)for(let f=-2;f<=2;f++){const u=new z(k,h);u.position.set(f/5,m/5,o/5),u.castShadow=!0,y.add(u)}s.add(y),this.object=y;const j=new q(3,3,1,1),D=new X,l=new L;l.visible=!1,this.volumeVisualization=l;for(let o=0,m=x.length;o<m;o++){const f=new Y({color:D.setHSL(o/m,.5,.5).getHex(),side:T,opacity:.2,transparent:!0,clippingPlanes:d.filter((st,I)=>I!==o)}),u=new z(j,f);u.matrixAutoUpdate=!1,l.add(u)}s.add(l);const b=new z(j,new A({color:10530223,shininess:10}));b.rotation.x=-Math.PI/2,b.scale.multiplyScalar(3),b.receiveShadow=!0,s.add(b),this.renderer.shadowMap.enabled=!0;const v=V(F.length);this.globalClippingPlanes=v,this.renderer.localClippingEnabled=!0,this.renderer.clippingPlanes=C;const w=new J(n,this.renderer.domElement);w.minDistance=1,w.maxDistance=8,w.target.set(0,1,0),w.update();const P=new $,g=this.renderer,M=P.addFolder("Local Clipping"),S={get Enabled(){return g.localClippingEnabled},set Enabled(o){g.localClippingEnabled=o,o||(l.visible=!1)},get Shadows(){return h.clipShadows},set Shadows(o){h.clipShadows=o},get Visualize(){return l.visible},set Visualize(o){g.localClippingEnabled&&(l.visible=o)}};M.add(S,"Enabled"),M.add(S,"Shadows"),M.add(S,"Visualize").listen(),M.open();const G=P.addFolder("Global Clipping");return G.add({get Enabled(){return g.clippingPlanes!==C},set Enabled(o){g.clippingPlanes=o?v:C}},"Enabled"),G.open(),()=>{P.destroy()}}run(){const e=super.run(),n=this.clock.getElapsedTime();if(this.object){this.object.position.y=1,this.object.rotation.x=n*.5,this.object.rotation.y=n*.2,this.object.updateMatrix(),this.transform.copy(this.object.matrix);const s=Math.cos(n*.5)*.5+.7;this.transform.multiply(this.tmpMatrix.makeScale(s,s,s)),R(this.clipMaterial.clippingPlanes,x,this.transform),this.volumeVisualization.children.forEach((r,d)=>{this.tmpMatrix.multiplyMatrices(this.transform,tt[d]),et(this.scene,r,this.tmpMatrix)}),this.transform.makeRotationY(n*.1),R(this.globalClippingPlanes,F,this.transform)}return e}}export{ct as default};
