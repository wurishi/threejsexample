var _=Object.defineProperty;var M=(h,i,e)=>i in h?_(h,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[i]=e;var t=(h,i,e)=>(M(h,typeof i!="symbol"?i+"":i,e),e);import{E as N,S as T,aj as O,_ as g,X as G,b as v,av as H,c as E,i as W,Z as u,aw as b,W as x,x as z,Y as D,V as y}from"./example-e9f3c815.js";import{G as j}from"./index-ba66c6be.js";class B extends N{constructor(){super(...arguments);t(this,"cameraPerspective");t(this,"cameraPerspectiveHelper");t(this,"cameraOrtho");t(this,"cameraOrthoHelper");t(this,"activeCamera");t(this,"activeHelper");t(this,"cameraRig");t(this,"mesh");t(this,"SCREEN_WIDTH",0);t(this,"SCREEN_HEIGHT",0);t(this,"aspect",1);t(this,"onResize",()=>{var e;this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.aspect=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,(e=this.renderer)==null||e.setSize(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.camera&&this.camera instanceof D&&(this.camera.aspect=.5*this.aspect,this.camera.updateProjectionMatrix()),this.cameraPerspective&&(this.cameraPerspective.aspect=.5*this.aspect,this.cameraPerspective.updateProjectionMatrix()),this.cameraOrtho&&(this.cameraOrtho.left=-.5*600*this.aspect/2,this.cameraOrtho.right=.5*600*this.aspect/2,this.cameraOrtho.top=600/2,this.cameraOrtho.bottom=-600/2,this.cameraOrtho.updateProjectionMatrix())})}init(e){super.init(e),this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.aspect=this.SCREEN_WIDTH/this.SCREEN_HEIGHT;const s=600,a=new T;this.scene=a;const c=this.utils.createPerspectiveCamera({fov:50,aspect:.5*this.aspect,far:1e4},[0,0,2500]);this.camera=c;const r=this.utils.createPerspectiveCamera({fov:50,aspect:.5*this.aspect,near:150,far:1e3});this.cameraPerspective=r;const l=new O(r);this.cameraPerspectiveHelper=l,a.add(l);const o=new g(.5*s*this.aspect/-2,.5*s*this.aspect/2,s/2,s/-2,150,1e3);this.cameraOrtho=o;const f=new O(o);this.cameraOrthoHelper=f,a.add(f),this.activeCamera=r,this.activeHelper=l,o.rotation.y=Math.PI,r.rotation.y=Math.PI;const n=new G;this.cameraRig=n,n.add(r,o),a.add(n);const d=new v(new H(100,16,8),new E({color:16777215,wireframe:!0}));this.mesh=d,a.add(d);const w=new v(new H(50,16,8),new E({color:65280,wireframe:!0}));w.position.y=150,d.add(w);const C=new v(new H(5,16,8),new E({color:255,wireframe:!0}));C.position.z=150,n.add(C);const P=new W,m=[];for(let p=0;p<1e4;p++)m.push(u.randFloatSpread(2e3)),m.push(u.randFloatSpread(2e3)),m.push(u.randFloatSpread(2e3));P.setAttribute("position",new b(m,3));const R=new x(P,new z({color:8947848}));a.add(R),this.renderer.autoClear=!1;const S=new j,I={type:"Perspective"};return S.add(I,"type",["Perspective","Ortho"]).name("当前摄像机").onChange(p=>{p==="Perspective"?(this.activeCamera=this.cameraPerspective,this.activeHelper=this.cameraPerspectiveHelper):(this.activeCamera=this.cameraOrtho,this.activeHelper=this.cameraOrthoHelper)}),()=>{S.destroy()}}run(){var s,a,c,r;const e=Date.now()*5e-4;return this.mesh&&(this.mesh.position.set(700*Math.cos(e),700*Math.sin(e),700*Math.sin(e)),this.mesh.children[0].position.x=70*Math.cos(2*e),this.mesh.children[0].position.z=70*Math.sin(e)),this.activeCamera&&(this.activeCamera===this.cameraPerspective?(this.cameraPerspective.fov=35+50*Math.sin(.5*e),this.cameraPerspective.far=((s=this.mesh)==null?void 0:s.position.length())||0,this.cameraPerspective.updateProjectionMatrix(),this.cameraPerspectiveHelper.update(),this.cameraPerspectiveHelper.visible=!0,this.cameraOrthoHelper.visible=!1):this.activeCamera===this.cameraOrtho&&(this.cameraOrtho.far=((a=this.mesh)==null?void 0:a.position.length())||0,this.cameraOrtho.updateProjectionMatrix(),this.cameraOrthoHelper.update(),this.cameraOrthoHelper.visible=!0,this.cameraPerspectiveHelper.visible=!1)),(r=this.cameraRig)==null||r.lookAt(((c=this.mesh)==null?void 0:c.position)||new y),this.renderer.clear(),this.activeHelper.visible=!1,this.renderer.setViewport(0,0,this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT),this.scene&&this.activeCamera&&this.renderer.render(this.scene,this.activeCamera),this.activeHelper.visible=!0,this.renderer.setViewport(this.SCREEN_WIDTH/2,0,this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT),this.scene&&this.camera&&this.renderer.render(this.scene,this.camera),e}}export{B as default};
