var F=Object.defineProperty;var S=(r,l,t)=>l in r?F(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t;var s=(r,l,t)=>(S(r,typeof l!="symbol"?l+"":l,t),t);import{E as v,aL as y,D as x,b as E,ak as M,al as P,aM as b,A as L}from"./example-e9f3c815.js";import{G as z}from"./GLTFLoader-27d86567.js";import{G as D}from"./index-ba66c6be.js";class B extends v{constructor(){super(...arguments);s(this,"model");s(this,"skeleton");s(this,"actions");s(this,"idleAction");s(this,"walkAction");s(this,"runAction");s(this,"poseAction");s(this,"start",!1);s(this,"settings",{"show model":!0,"show skeleton":!1,"modify step size":.05,"use default duration":!0,"set custom duration":3.5,"modify idle weight":0,"modify walk weight":1,"modify run weight":0,"modify time scale":1});s(this,"singleStepMode",!1);s(this,"sizeOfNextStep",0);s(this,"crossFadeControls",[]);s(this,"createPanel",t=>{const e=new D({width:310,name:"blending"});t.appendChild(e.domElement.parentElement);const o=e.addFolder("Visibility");o.add(this.settings,"show model").onChange(d=>{this.model&&(this.model.visible=d)}),o.add(this.settings,"show skeleton").onChange(d=>this.skeleton&&(this.skeleton.visible=d)),o.open(),this.settings["activate all"]=this.activateAllActions,this.settings["deactivate all"]=this.deactivateAllActions;const a=e.addFolder("Activation/Deactivation");a.add(this.settings,"deactivate all"),a.add(this.settings,"activate all"),a.open(),this.settings["pause/continue"]=this.pauseContinue,this.settings["make single step"]=this.toSingleStepMode;const i=e.addFolder("Pausing/Stepping");i.add(this.settings,"pause/continue"),i.add(this.settings,"make single step"),i.add(this.settings,"modify step size",.01,.1,.001),i.open(),this.settings["from walk to idle"]=()=>this.prepareCrossFade(this.walkAction,this.idleAction,1),this.settings["from idle to walk"]=()=>this.prepareCrossFade(this.idleAction,this.walkAction,.5),this.settings["from walk to run"]=()=>this.prepareCrossFade(this.walkAction,this.runAction,2.5),this.settings["from run to walk"]=()=>this.prepareCrossFade(this.runAction,this.walkAction,5);const n=e.addFolder("Crossfading");this.crossFadeControls.push(n.add(this.settings,"from walk to idle")),this.crossFadeControls.push(n.add(this.settings,"from idle to walk")),this.crossFadeControls.push(n.add(this.settings,"from walk to run")),this.crossFadeControls.push(n.add(this.settings,"from run to walk")),n.add(this.settings,"use default duration"),n.add(this.settings,"set custom duration",0,10,.01),n.open();const h=e.addFolder("Blend Weights");h.add(this.settings,"modify idle weight",0,1,.01).listen().onChange(d=>{this.setWeight(this.idleAction,d)}),h.add(this.settings,"modify walk weight",0,1,.01).listen().onChange(d=>{this.setWeight(this.walkAction,d)}),h.add(this.settings,"modify run weight",0,1,.01).listen().onChange(d=>{this.setWeight(this.runAction,d)}),h.open();const f=e.addFolder("General Speed");return f.add(this.settings,"modify time scale",0,1.5,.01).onChange(d=>{this.mixer.timeScale=d}),f.open(),()=>{e.destroy()}});s(this,"activateAllActions",()=>{var t;this.setWeight(this.idleAction,this.settings["modify idle weight"]),this.setWeight(this.walkAction,this.settings["modify walk weight"]),this.setWeight(this.runAction,this.settings["modify run weight"]),(t=this.actions)==null||t.forEach(e=>{e.play()})});s(this,"deactivateAllActions",()=>{var t;(t=this.actions)==null||t.forEach(e=>{e.stop()})});s(this,"setWeight",(t,e)=>{t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(e)});s(this,"pauseContinue",()=>{var t;this.singleStepMode?(this.singleStepMode=!1,this.unPauseAllActions()):(t=this.idleAction)!=null&&t.paused?this.unPauseAllActions():this.pauseAllActions()});s(this,"unPauseAllActions",()=>{var t;(t=this.actions)==null||t.forEach(e=>e.paused=!1)});s(this,"pauseAllActions",()=>{var t;(t=this.actions)==null||t.forEach(e=>e.paused=!0)});s(this,"toSingleStepMode",()=>{this.unPauseAllActions(),this.singleStepMode=!0,this.sizeOfNextStep=this.settings["modify step size"]});s(this,"prepareCrossFade",(t,e,o)=>{const a=this.setCrossFadeDuration(o);this.singleStepMode=!1,this.unPauseAllActions(),t===this.idleAction?this.executeCrossFade(t,e,a):this.synchronizeCrossFade(t,e,a)});s(this,"setCrossFadeDuration",t=>this.settings["use default duration"]?t:Number(this.settings["set custom duration"]));s(this,"executeCrossFade",(t,e,o)=>{this.setWeight(e,1),e.time=1,t.crossFadeTo(e,o,!0)});s(this,"synchronizeCrossFade",(t,e,o)=>{var i;const a=n=>{var h;n.action===t&&((h=this.mixer)==null||h.removeEventListener("loop",a),this.executeCrossFade(t,e,o))};(i=this.mixer)==null||i.addEventListener("loop",a)});s(this,"idleWeight",0);s(this,"walkWeight",0);s(this,"runWeight",0);s(this,"updateWeightSliders",()=>{this.settings["modify idle weight"]=this.idleWeight,this.settings["modify walk weight"]=this.walkWeight,this.settings["modify run weight"]=this.runWeight});s(this,"updateCrossFadeControls",()=>{this.idleWeight===1&&this.walkWeight===0&&this.runWeight,this.idleWeight===0&&this.walkWeight===1&&this.runWeight,this.idleWeight===0&&this.walkWeight===0&&this.runWeight})}init(t){super.init(t);const e=this.utils.createPerspectiveCamera({far:1e3},[1,2,-3],[0,1,0]);this.camera=e;const o=this.utils.createScene(null,[]);this.scene=o;const a=new y(16777215,4473924);a.position.set(0,20,0),o.add(a);const i=new x(16777215);i.position.set(-3,10,-10),i.castShadow=!0,i.shadow.camera.top=2,i.shadow.camera.bottom=-2,i.shadow.camera.left=-2,i.shadow.camera.right=2,i.shadow.camera.near=.1,i.shadow.camera.far=40,o.add(i),this.renderer.shadowMap.enabled=!0;const n=new E(new M(100,100),new P({color:10066329,depthWrite:!1}));n.rotation.x=-Math.PI/2,n.receiveShadow=!0,o.add(n);let h;return new z().load("assets/models/gltf/Soldier.glb",d=>{const c=d.scene;this.model=c,o.add(c),c.traverse(C=>{const p=C;p!=null&&p.isMesh&&(p.castShadow=!0)});const m=new b(c);this.skeleton=m,m.visible=!1,o.add(m),h=this.createPanel(t.ui);const u=d.animations,g=new L(c);this.mixer=g;const w=g.clipAction(u[0]);this.idleAction=w;const A=g.clipAction(u[1]);this.runAction=A;const W=g.clipAction(u[2]);this.poseAction=W;const k=g.clipAction(u[3]);this.walkAction=k,this.actions=[w,k,A],this.activateAllActions(),this.start=!0}),()=>{this.start=!1,h&&h()}}run(){var e,o,a,i,n,h;if(!this.start)return 0;this.idleWeight=(e=this.idleAction)==null?void 0:e.getEffectiveWeight(),this.walkWeight=(o=this.walkAction)==null?void 0:o.getEffectiveWeight(),this.runWeight=(a=this.runAction)==null?void 0:a.getEffectiveWeight(),this.updateWeightSliders(),this.updateCrossFadeControls();let t=this.clock.getDelta();return this.singleStepMode&&(t=this.sizeOfNextStep,this.sizeOfNextStep=0),(i=this.mixer)==null||i.update(t),(n=this.controls)==null||n.update(),this.scene&&this.camera&&((h=this.renderer)==null||h.render(this.scene,this.camera)),t}}export{B as default};
